<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ… å¤šç«¯åŒæ­¥ç•ªèŒ„é’Ÿ</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; background: #fafafa; }
    #timer { font-size: 4em; margin: 20px; color: #e74c3c; }
    button { font-size: 1.1em; padding: 10px 20px; margin: 8px; border: none; border-radius: 6px; cursor: pointer; }
    #start { background: #2ecc71; color: white; }
    #pause { background: #f39c12; color: white; }
    #reset { background: #e74c3c; color: white; }
    #stats { margin-top: 20px; font-size: 1.2em; }
  </style>
</head>
<body>
  <h1>ğŸ… å¤šç«¯åŒæ­¥ç•ªèŒ„é’Ÿ</h1>
  <div id="timer">25:00</div>
  <div>
    <button id="start">å¼€å§‹</button>
    <button id="pause">æš‚åœ</button>
    <button id="reset">å®Œæˆ</button>
  </div>
  <div id="stats">ä»Šæ—¥å·²å®Œæˆï¼š<span id="count">0</span> ä¸ª</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    // 
    const firebaseConfig = {
  apiKey: "AIzaSyBOpjakF903xdKJqkGlR71t0OuWVGNildU",
  authDomain: "pomodoro-sync-19daf.firebaseapp.com",
  projectId: "pomodoro-sync-19daf",
  storageBucket: "pomodoro-sync-19daf.firebasestorage.app",
  messagingSenderId: "1027981227301",
  appId: "1:1027981227301:web:6bd19e59826816916996cc",
  measurementId: "G-SKRVKBBNGX"
};
    // 

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const timerRef = db.ref('timer');
    const today = new Date().toISOString().split('T')[0];
    const historyRef = db.ref('history/' + today);

    let remaining = 25 * 60;
    let isRunning = false;
    let localTimer = null;

    const fmt = s => {
      const m = Math.floor(s / 60).toString().padStart(2, '0');
      const ss = (s % 60).toString().padStart(2, '0');
      return `${m}:${ss}`;
    };

    const updateUI = () => {
      document.getElementById('timer').textContent = fmt(remaining);
    };

    // ç›‘å¬è¿œç¨‹çŠ¶æ€
    timerRef.on('value', snapshot => {
      const data = snapshot.val() || { remaining: 25 * 60, isRunning: false };
      remaining = data.remaining;
      isRunning = data.isRunning;
      updateUI();
      if (isRunning && !localTimer) {
        startLocalTimer();
      } else if (!isRunning && localTimer) {
        clearInterval(localTimer);
        localTimer = null;
      }
    });

    // ç›‘å¬ä»Šæ—¥å®Œæˆæ•°
    historyRef.on('value', snap => {
      document.getElementById('count').textContent = snap.exists() ? snap.numChildren() : 0;
    });

    function startLocalTimer() {
      localTimer = setInterval(() => {
        if (remaining > 0) {
          remaining--;
          updateUI();
          timerRef.set({ remaining, isRunning: true });
        } else {
          clearInterval(localTimer);
          localTimer = null;
          finishPomodoro();
        }
      }, 1000);
    }

    function finishPomodoro() {
      timerRef.set({ remaining: 25 * 60, isRunning: false });
      historyRef.push({ completedAt: new Date().toISOString() });
      remaining = 25 * 60;
      updateUI();
      alert('ğŸ… ç•ªèŒ„é’Ÿå®Œæˆï¼');
    }

    document.getElementById('start').onclick = () => {
      if (!isRunning) {
        isRunning = true;
        startLocalTimer();
        timerRef.set({ remaining, isRunning: true });
      }
    };
    document.getElementById('pause').onclick = () => {
      if (isRunning) {
        clearInterval(localTimer);
        localTimer = null;
        isRunning = false;
        timerRef.set({ remaining, isRunning: false });
      }
    };
    document.getElementById('reset').onclick = finishPomodoro;

    updateUI();
  </script>
</body>
</html>
